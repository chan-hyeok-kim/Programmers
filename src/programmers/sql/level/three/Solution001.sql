SELECT A.NAME, A.DATETIME
  FROM (
SELECT AI.ANIMAL_ID,AI.NAME,AI.DATETIME,DENSE_RANK()OVER(ORDER BY SYSDATE-AI.DATETIME DESC) AS RANK
  FROM ANIMAL_INS AI
 WHERE NOT EXISTS (SELECT 1
                     FROM ANIMAL_OUTS AO
                    WHERE AO.ANIMAL_ID=AI.ANIMAL_ID) 
) A
 WHERE A.RANK<=3;
	 -- 오랜 기간 보호한 동물
     -- 이건 EXISTS를 안쓰고 JOIN을 쓰는 방식
 SELECT A.NAME, A.DATETIME
FROM (
    SELECT AI.ANIMAL_ID, AI.NAME, AI.DATETIME, DENSE_RANK() OVER (ORDER BY SYSDATE - AI.DATETIME DESC) AS RANK
    FROM ANIMAL_INS AI
    LEFT OUTER JOIN ANIMAL_OUTS AO ON AI.ANIMAL_ID = AO.ANIMAL_ID
    WHERE AO.ANIMAL_ID IS NULL
) A
WHERE A.RANK <= 3;

  